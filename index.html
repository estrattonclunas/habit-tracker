<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Habit Tracker</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#3b82f6">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <style>body{margin:0;font-family:system-ui,sans-serif}*{box-sizing:border-box}</style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const Icon = ({ name, className }) => {
      const ref = React.useRef();
      useEffect(() => { if (ref.current) lucide.createIcons({ nodes: [ref.current] }); }, []);
      return <i ref={ref} data-lucide={name} className={className}></i>;
    };

    const STATIONS = ['Lynnwood City Center','Mountlake Terrace','Shoreline South/148th','Shoreline North/185th','Northgate','Roosevelt','U District','University of Washington','Capitol Hill','Westlake','University Street','Pioneer Square','International District','Stadium','SODO','Beacon Hill','Mount Baker','Columbia City','Othello','Rainier Beach','Tukwila International Blvd','SeaTac Airport','Angle Lake','Redmond Technology','Overlake Village','Spring District','Bellevue Downtown','East Main','South Bellevue','Mercer Island','Judkins Park'];
    const DEFAULT_HABITS = [
      { id: 1, name: 'Exercise', emoji: 'ğŸ’ª' },
      { id: 2, name: 'Read', emoji: 'ğŸ“š' },
      { id: 3, name: 'Drink water', emoji: 'ğŸ’§' },
      { id: 4, name: 'Meditate', emoji: 'ğŸ§˜' },
      { id: 5, name: 'Journal', emoji: 'âœï¸' }
    ];

    const getDateKey = (date) => date.toISOString().split('T')[0];
    const getDayName = (date) => date.toLocaleDateString('en-US', { weekday: 'short' });
    const getMonthName = (date) => date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

    function HabitTracker() {
      const [habits, setHabits] = useState(() => {
        const saved = localStorage.getItem('habits');
        return saved ? JSON.parse(saved) : DEFAULT_HABITS;
      });
      const [log, setLog] = useState(() => {
        const saved = localStorage.getItem('habitLog');
        return saved ? JSON.parse(saved) : {};
      });
      const [view, setView] = useState('today');
      const [showAddHabit, setShowAddHabit] = useState(false);
      const [newHabit, setNewHabit] = useState({ name: '', emoji: 'â­' });
      const [calendarMonth, setCalendarMonth] = useState(new Date());

      useEffect(() => { localStorage.setItem('habits', JSON.stringify(habits)); }, [habits]);
      useEffect(() => { localStorage.setItem('habitLog', JSON.stringify(log)); }, [log]);

      const today = new Date();
      const todayKey = getDateKey(today);

      const toggleHabit = (habitId, dateKey = todayKey) => {
        setLog(prev => {
          const dayLog = prev[dateKey] || [];
          if (dayLog.includes(habitId)) return { ...prev, [dateKey]: dayLog.filter(id => id !== habitId) };
          return { ...prev, [dateKey]: [...dayLog, habitId] };
        });
      };

      const addHabit = () => {
        if (!newHabit.name.trim()) return;
        setHabits([...habits, { id: Date.now(), name: newHabit.name, emoji: newHabit.emoji }]);
        setNewHabit({ name: '', emoji: 'â­' });
        setShowAddHabit(false);
      };

      const deleteHabit = (id) => {
        setHabits(habits.filter(h => h.id !== id));
        setLog(prev => {
          const updated = {};
          Object.keys(prev).forEach(k => { updated[k] = prev[k].filter(hid => hid !== id); });
          return updated;
        });
      };

      const getStreak = (habitId) => {
        let streak = 0, d = new Date(today);
        while (true) {
          const key = getDateKey(d);
          if (log[key]?.includes(habitId)) { streak++; d.setDate(d.getDate() - 1); }
          else if (getDateKey(d) === todayKey) { d.setDate(d.getDate() - 1); }
          else break;
        }
        return streak;
      };

      const getLast7Days = () => {
        const days = [];
        for (let i = 6; i >= 0; i--) { const d = new Date(today); d.setDate(d.getDate() - i); days.push(d); }
        return days;
      };

      const getWeeklyCompletion = () => {
        const days = getLast7Days();
        let total = 0, completed = 0;
        days.forEach(d => {
          const key = getDateKey(d);
          total += habits.length;
          completed += (log[key] || []).filter(id => habits.some(h => h.id === id)).length;
        });
        return total > 0 ? Math.round((completed / total) * 100) : 0;
      };

      const getCalendarDays = () => {
        const year = calendarMonth.getFullYear(), month = calendarMonth.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const days = [];
        for (let i = 0; i < firstDay; i++) days.push(null);
        for (let i = 1; i <= daysInMonth; i++) days.push(new Date(year, month, i));
        return days;
      };

      const todayLog = log[todayKey] || [];
      const completedToday = todayLog.filter(id => habits.some(h => h.id === id)).length;
      const emojis = ['â­','ğŸ’ª','ğŸ“š','ğŸ’§','ğŸ§˜','âœï¸','ğŸƒ','ğŸ¥—','ğŸ˜´','ğŸ¯','ğŸ’Š','ğŸ§¹','ğŸ“±','ğŸ¨','ğŸµ'];

      return (
        <div className="min-h-screen bg-gray-50">
          <div className="max-w-md mx-auto p-4">
            <div className="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-5 text-white mb-4">
              <h1 className="text-2xl font-bold mb-1">Habit Tracker</h1>
              <p className="text-white/80 text-sm">{today.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'})}</p>
              <div className="flex items-center gap-4 mt-4">
                <div className="flex items-center gap-2">
                  <div className="bg-white/20 rounded-full p-2"><Icon name="check" className="w-5 h-5"/></div>
                  <div><div className="text-2xl font-bold">{completedToday}/{habits.length}</div><div className="text-xs text-white/70">Today</div></div>
                </div>
                <div className="flex items-center gap-2">
                  <div className="bg-white/20 rounded-full p-2"><Icon name="trending-up" className="w-5 h-5"/></div>
                  <div><div className="text-2xl font-bold">{getWeeklyCompletion()}%</div><div className="text-xs text-white/70">This week</div></div>
                </div>
              </div>
            </div>

            <div className="flex gap-2 mb-4">
              {[['today','Today'],['stats','Stats'],['calendar','Calendar']].map(([key,label])=>(
                <button key={key} onClick={()=>setView(key)} className={`flex-1 py-2 rounded-xl text-sm font-medium transition ${view===key?'bg-blue-100 text-blue-700':'bg-white text-gray-600'}`}>{label}</button>
              ))}
            </div>

            {view==='today'&&(
              <div className="space-y-2">
                {habits.map(habit=>{
                  const done=todayLog.includes(habit.id), streak=getStreak(habit.id);
                  return(
                    <div key={habit.id} onClick={()=>toggleHabit(habit.id)} className={`bg-white rounded-xl p-4 flex items-center gap-3 cursor-pointer transition ${done?'ring-2 ring-blue-400':''}`}>
                      <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${done?'bg-blue-500':'bg-gray-100'}`}>
                        {done?<Icon name="check" className="w-5 h-5 text-white"/>:habit.emoji}
                      </div>
                      <div className="flex-1">
                        <div className={`font-medium ${done?'text-blue-700':'text-gray-800'}`}>{habit.name}</div>
                        {streak>0&&<div className="text-xs text-orange-500 flex items-center gap-1"><Icon name="flame" className="w-3 h-3"/>{streak} day streak</div>}
                      </div>
                      {done&&<span className="text-blue-500 text-sm font-medium">Done!</span>}
                    </div>
                  );
                })}
                <button onClick={()=>setShowAddHabit(true)} className="w-full bg-white rounded-xl p-4 flex items-center justify-center gap-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 transition">
                  <Icon name="plus" className="w-5 h-5"/> Add Habit
                </button>
                {habits.length>0&&(
                  <details className="bg-white rounded-xl mt-4">
                    <summary className="p-3 text-sm text-gray-500 cursor-pointer">Manage habits</summary>
                    <div className="px-3 pb-3 space-y-2">
                      {habits.map(h=>(
                        <div key={h.id} className="flex items-center justify-between py-2 border-t">
                          <span className="flex items-center gap-2"><span>{h.emoji}</span><span className="text-sm">{h.name}</span></span>
                          <button onClick={()=>deleteHabit(h.id)} className="text-red-400 hover:text-red-600"><Icon name="trash-2" className="w-4 h-4"/></button>
                        </div>
                      ))}
                    </div>
                  </details>
                )}
              </div>
            )}

            {view==='stats'&&(
              <div className="space-y-3">
                <div className="bg-white rounded-xl p-4">
                  <h3 className="font-semibold text-gray-800 mb-3">Last 7 Days</h3>
                  <div className="flex justify-between">
                    {getLast7Days().map(d=>{
                      const key=getDateKey(d), completed=(log[key]||[]).filter(id=>habits.some(h=>h.id===id)).length;
                      const pct=habits.length>0?(completed/habits.length)*100:0, isToday=key===todayKey;
                      return(
                        <div key={key} className="flex flex-col items-center gap-1">
                          <div className="text-xs text-gray-500">{getDayName(d)}</div>
                          <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-medium ${pct===100?'bg-green-500 text-white':pct>0?'bg-blue-100 text-blue-700':'bg-gray-100 text-gray-400'} ${isToday?'ring-2 ring-blue-400':''}`}>{completed}</div>
                        </div>
                      );
                    })}
                  </div>
                </div>
                <div className="bg-white rounded-xl p-4">
                  <h3 className="font-semibold text-gray-800 mb-3">Habit Streaks</h3>
                  <div className="space-y-2">
                    {habits.map(h=>{
                      const streak=getStreak(h.id);
                      return(<div key={h.id} className="flex items-center gap-3"><span className="text-xl">{h.emoji}</span><span className="flex-1 text-sm text-gray-700">{h.name}</span><div className="flex items-center gap-1 text-orange-500"><Icon name="flame" className="w-4 h-4"/><span className="font-semibold">{streak}</span></div></div>);
                    })}
                  </div>
                </div>
                <div className="bg-gradient-to-r from-amber-400 to-orange-500 rounded-xl p-4 text-white">
                  <div className="flex items-center gap-2 mb-1"><Icon name="trophy" className="w-5 h-5"/><span className="font-semibold">Best Streak</span></div>
                  <div className="text-3xl font-bold">{Math.max(...habits.map(h=>getStreak(h.id)),0)} days</div>
                </div>
              </div>
            )}

            {view==='calendar'&&(
              <div className="bg-white rounded-xl p-4">
                <div className="flex items-center justify-between mb-4">
                  <button onClick={()=>setCalendarMonth(new Date(calendarMonth.getFullYear(),calendarMonth.getMonth()-1))} className="p-1 hover:bg-gray-100 rounded"><Icon name="chevron-left" className="w-5 h-5"/></button>
                  <span className="font-semibold">{getMonthName(calendarMonth)}</span>
                  <button onClick={()=>setCalendarMonth(new Date(calendarMonth.getFullYear(),calendarMonth.getMonth()+1))} className="p-1 hover:bg-gray-100 rounded"><Icon name="chevron-right" className="w-5 h-5"/></button>
                </div>
                <div className="grid grid-cols-7 gap-1 text-center text-xs text-gray-500 mb-2">
                  {['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d=><div key={d}>{d}</div>)}
                </div>
                <div className="grid grid-cols-7 gap-1">
                  {getCalendarDays().map((d,i)=>{
                    if(!d)return<div key={i}/>;
                    const key=getDateKey(d), completed=(log[key]||[]).filter(id=>habits.some(h=>h.id===id)).length;
                    const pct=habits.length>0?(completed/habits.length)*100:0, isToday=key===todayKey;
                    return(<div key={i} className={`aspect-square rounded-lg flex items-center justify-center text-sm ${pct===100?'bg-green-500 text-white':pct>0?'bg-blue-100 text-blue-700':'bg-gray-50 text-gray-600'} ${isToday?'ring-2 ring-blue-500':''}`}>{d.getDate()}</div>);
                  })}
                </div>
                <div className="flex items-center justify-center gap-4 mt-4 text-xs text-gray-500">
                  <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-gray-50 border"></span> None</span>
                  <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-blue-100"></span> Some</span>
                  <span className="flex items-center gap-1"><span className="w-3 h-3 rounded bg-green-500"></span> All</span>
                </div>
              </div>
            )}

            {showAddHabit&&(
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-2xl p-5 w-full max-w-sm">
                  <div className="flex items-center justify-between mb-4">
                    <h3 className="font-semibold text-lg">Add New Habit</h3>
                    <button onClick={()=>setShowAddHabit(false)} className="text-gray-400 hover:text-gray-600"><Icon name="x" className="w-5 h-5"/></button>
                  </div>
                  <input type="text" placeholder="Habit name" value={newHabit.name} onChange={e=>setNewHabit({...newHabit,name:e.target.value})} className="w-full border rounded-xl px-4 py-3 mb-3" autoFocus/>
                  <div className="mb-4">
                    <div className="text-sm text-gray-600 mb-2">Pick an emoji</div>
                    <div className="flex flex-wrap gap-2">
                      {emojis.map(e=>(<button key={e} onClick={()=>setNewHabit({...newHabit,emoji:e})} className={`w-10 h-10 rounded-lg text-xl flex items-center justify-center ${newHabit.emoji===e?'bg-blue-100 ring-2 ring-blue-400':'bg-gray-100'}`}>{e}</button>))}
                    </div>
                  </div>
                  <button onClick={addHabit} className="w-full bg-blue-500 text-white py-3 rounded-xl font-medium hover:bg-blue-600">Add Habit</button>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<HabitTracker/>);
  </script>
</body>
</html>
